---
title: "Error bar graph"
author: "Matthew Perkins"
date: "2022-09-23"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

For using the function that plots the confidence intervals shown below a table containing confidence intervals for a given n and $\lambda$ are necessary with column names that follow the standardized names we agreed to. Specifically the column names estimate, CI_Lend, CI_Uend, captured, and above_miss are needed for the function to work. 


```{r}


# function to plot the estimates with confidence intervals and have 
#  a color indicator for whether the confidence interval captured the parameter 
# or missed above or missed below
plot_CI = function(CI_table, parameter, title=NULL){
  # CI_table: a data.frame or tibble that contains performance data about the confidence 
  # intervals for each sample. Must contain column names: captured, above_miss, estimate,
  # CI_Lend, CI_Uend
  # parameter: numeric, this is the parameter we are trying to estimate. For exponential 
  # it will be lambda, and for gamma(2, lambda) it will be lambda/2
  # title: string, optional argument if you want to add a title to your graph. 
  
  library(tidyverse) # load library just in case
  
  # the sequence below involving the forward pipe operator in R (requires magrittr
  # package), will add a factor column to the table (string column) so that 
  # we can use that to color the CIs based on whether they captured the parameter
  # or not, and, if not, were they too high or low. This column is necessary because
  # we used 3 columns to cover this information previously and that wouldn't 
  # work well on a plot. Combining this information into one column
  # allows us to use one graphical property instead and giving them names 
  # makes reading the legend easier. 
  CI_table = CI_table %>%
    mutate(col_factor = ifelse(captured,'captured',
                               ifelse(above_miss,
                                      'interval above parameter',
                                      'interval below parameter')))
  
  # plotting the first 500 CIs (samples) by creating a scatter plot first with
  # the x-axis being the indicator of what sample/CI it is and the y value
  # being the estimate. The string column from earlier is used as the 
  # color aesthetic for the entire plot. 
  out = ggplot(CI_table[1:500, ], aes(x=1:500, y=estimate, col=col_factor))+
    geom_point()+
    # adding errorbars for a nice vertical line to indicate the confidence interval
    geom_errorbar(aes(ymin=CI_Lend, ymax=CI_Uend))+
    # add parameter value to as a horizontal line to give reference to 
    # the confidence intervals and how they did. 
    geom_hline(aes(yintercept=parameter))+
    ylab('estimates')+
    xlab('sample number')+
    # change legend label
    labs(col='CI capture status')
  # checks to see if title parameter isn't null and is a character
  # if conditions met then add title to graph
  if(!is.null(title) & class(title)=='character'){
    out = out+
      # add title
      labs(title=title)+
      # adjust title position to center
      theme(plot.title = element_text(hjust=0.5))
  }
  return(out)
}


```



Below is an example of using the function 
```{r, fig.heigh=10}
# loading in my list of tables for different n and lambda values for the 
# exponential distribution using the reflected percentile method
list_tables = readRDS('./output/alpha_1method_reflected.rds')
# have table one be the confidence intervals for n=10 lambda=0.5
table_one = list_tables[['n_10lambda_0.5']]
# have table two be the confidence intervals for n=100 lambda=0.5
table_two = list_tables[['n_100lambda_0.5']]
# create a 2x1 grid for plotting the two error bar graphs 
library(patchwork)
plot_one = plot_CI(table_one, parameter = 0.5, title = 'CI plot for n=10 lambda=0.5')
plot_two = plot_CI(table_two, parameter = 0.5, title = 'CI plot for n=100 lambda=0.5')
plot_one / plot_two
```


Notice that with larger sample size we have much smaller lengths of intervals (see how y axis changes to tenths digit instead of ones).

